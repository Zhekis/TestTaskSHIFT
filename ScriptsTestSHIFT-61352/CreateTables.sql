-- Создание таблицы SHOPS
CREATE TABLE SHOPS (
	ID INT NOT NULL IDENTITY,
	NAME VARCHAR(200),
	REGION VARCHAR(200),
	CITY VARCHAR(200),
	ADDRESS VARCHAR(200),
	MANAGER_ID INT NOT NULL,
	CONSTRAINT PK_SHOPS PRIMARY KEY CLUSTERED (ID)
);

-- Заполнение таблицы SHOPS
INSERT INTO SHOPS (NAME, REGION, CITY, ADDRESS, MANAGER_ID)
VALUES
    ('Пятерка', 'Пермский','Пермь', 'Адрес 1', 101),
    ('Магнит', 'Сибирский','Новосибирск','Адрес 2', 102),
    ('Монетка', 'Центральный','Москва','Адрес 3', 103);

-- Создание таблицы EMPLOYEES
CREATE TABLE EMPLOYEES (
    	ID INT NOT NULL IDENTITY,
    	FIRST_NAME VARCHAR(100),
    	LAST_NAME VARCHAR(100),
    	PHONE VARCHAR(50),
    	E_MAIL VARCHAR(50),
    	JOB_NAME VARCHAR(50),
    	SHOP_ID INT,
	CONSTRAINT PK_EMPLOYEES PRIMARY KEY CLUSTERED (ID)
);

-- Заполнение таблицы EMPLOYEES
SET IDENTITY_INSERT EMPLOYEES ON;
INSERT INTO EMPLOYEES (ID, FIRST_NAME, LAST_NAME, PHONE, E_MAIL, JOB_NAME, SHOP_ID)
VALUES
    (101, 'Иван', 'Иванов', '+7453611', 'iv@c.ru', 'Директор', 1),
    (102, 'Петр', 'Петров', '+7453624', 'pp@ct.ru',  'Продавец-консультант', 1),
    (103, 'Анна', 'Сидорова', '+7453644', 'as@pt.ru', 'Продавец-консультант', 2),
    (104, 'Мария', 'Павлова', '+7453655', 'mp@ya.ru',  'Управляющий', 3),
    (105, 'Inna', 'Павлова', '+7453699', 'ip@ya.ru',  'Продавец-консультант', 3),
    (106, 'Lena', 'Petrova', '+7453600', 'lp@ya.ru',  'Продавец-консультант', 1);
SET IDENTITY_INSERT EMPLOYEES OFF;

ALTER TABLE SHOPS
ADD CONSTRAINT FK_SHOPS_EMPLOYEES FOREIGN KEY (MANAGER_ID) REFERENCES EMPLOYEES (ID); 

ALTER TABLE EMPLOYEES 
ADD CONSTRAINT FK_EMPLOYEES_SHOPS FOREIGN KEY (SHOP_ID) REFERENCES SHOPS (ID); 

-- Создание таблицы PURCHASES
CREATE TABLE PURCHASES (
    	ID INT NOT NULL IDENTITY,
    	DATETIME DATETIME,
    	AMOUNT DECIMAL(10, 2),
    	SELLER_ID INT,
	CONSTRAINT PK_PURCHASES PRIMARY KEY CLUSTERED (ID),
    	CONSTRAINT FK_PURCHASES_EMPLOYEES FOREIGN KEY (SELLER_ID) REFERENCES EMPLOYEES(ID)
);

-- Создание таблицы PRODUCTS
CREATE TABLE PRODUCTS (
    	ID INT NOT NULL IDENTITY,
    	CODE VARCHAR(50),
    	NAME VARCHAR(200)
	CONSTRAINT PK_PRODUCTS PRIMARY KEY CLUSTERED (ID),
	CONSTRAINT UK_PRODUCTS_CODE UNIQUE (CODE)
);

-- Создание таблицы PURCHASE_RECEIPTS
CREATE TABLE PURCHASE_RECEIPTS (
    	PURCHASE_ID INT NOT NULL,
    	ORDINAL_NUMBER INT NOT NULL,
    	PRODUCT_ID INT,
    	QUANTITY INT,
    	AMOUNT_FULL DECIMAL(10, 2),
    	AMOUNT_DISCOUNT DECIMAL(5, 2),
	CONSTRAINT PK_PURCHASE_RECEIPTS PRIMARY KEY CLUSTERED (PURCHASE_ID, ORDINAL_NUMBER),	
    	CONSTRAINT FK_PURCHASE_RECEIPTS_PURCHASES FOREIGN KEY (PURCHASE_ID) REFERENCES PURCHASES(ID),
    	CONSTRAINT FK_PURCHASE_RECEIPTS_PRODUCTS FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(ID)
);

-- Заполнение таблицы PURCHASES
INSERT INTO PURCHASES (DATETIME, AMOUNT, SELLER_ID)
VALUES
    ('2024-04-01 10:00:00', 100.00, 102),
    ('2024-04-02 11:30:00', 150.00, 103),
    ('2024-04-03 14:45:00', 200.00, NULL),
    ('2024-02-03 14:45:00', 10.00, 101),
    ('2024-03-02 11:30:00', 200.00, 105),
    ('2024-04-02 14:45:00', 100.00, 102),
    ('2024-04-13 11:45:00', 250.00, 102),
    ('2024-02-01 10:00:00', 40.00, 101);

-- Заполнение таблицы PRODUCTS
INSERT INTO PRODUCTS (CODE, NAME)
VALUES
    ('Т1', 'Овощи'),
    ('Т2', 'Напитки'),
    ('Т3', 'Хлеб'),
    ('Т4', 'Beer'),
    ('Т5', 'Fruits');

-- Заполнение таблицы PURCHASE_RECEIPTS
INSERT INTO PURCHASE_RECEIPTS (PURCHASE_ID, ORDINAL_NUMBER, PRODUCT_ID, QUANTITY, AMOUNT_FULL, AMOUNT_DISCOUNT)
VALUES
    (1, 1, 1, 2, 50.00, 0),
    (2, 1, 2, 2, 50.00, 0),
    (2, 2, 1, 3, 80.00, 10.00),
    (1, 3, 3, 3, 90.00, 5.00),
    (1, 2, 2, 5, 30.00, 0),
    (3, 1, 1, 2, 50.00, 0),
    (3, 2, 2, 1, 120.00, 15.00),
    (4, 1, 4, 2, 5.00, 0.00),
    (5, 1, 1, 1, 200.00, 5.00),
    (6, 1, 3, 1, 150.00, 1.00),
    (7, 1, 2, 1, 250.00, 5.00);
